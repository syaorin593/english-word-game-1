<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Word Quest: Grade 1 Complete</title>
<style>
    @import url('https://fonts.googleapis.com/css2?family=DotGothic16&family=Press+Start+2P&display=swap');
    :root { --bg: #1a1a20; --panel: rgba(30,30,40,0.95); --acc: #ffd700; --hp: #00ffaa; --dmg: #ff4444; --font: 'DotGothic16', sans-serif; }
    * { box-sizing: border-box; user-select: none; }
    body { margin: 0; background: var(--bg); color: #fff; font-family: var(--font); height: 100vh; display: flex; justify-content: center; align-items: center; overflow: hidden; }
    #app { width: 100%; max-width: 900px; height: 100%; max-height: 700px; position: relative; background: #111; border: 2px solid #555; border-radius: 12px; overflow: hidden; box-shadow: 0 0 50px #000; }
    
    #error-box { display:none; position:absolute; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); z-index:99999; color:#ff5555; padding:20px; white-space:pre-wrap; font-family:monospace; text-align:left; overflow:auto; font-size: 14px; line-height: 1.5; }

    .screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: none; flex-direction: column; background: #15151a; z-index: 10; }
    .screen.active { display: flex; }
    .center { align-items: center; justify-content: center; text-align: center; }
    .hidden { display: none !important; }

    h1 { color: var(--acc); margin: 10px; text-shadow: 2px 2px 0 #000; font-size: 40px; cursor: pointer; }
    h1:active { transform: scale(0.95); }
    .btn { background: #334; border: 2px solid #667; color: #fff; padding: 10px 20px; font-family: inherit; font-size: 16px; cursor: pointer; border-radius: 4px; margin: 5px; transition: 0.1s; }
    .btn:hover { border-color: var(--acc); background: #445; }
    .start-btn { width: 220px; padding: 20px; font-size: 20px; background: #2a4; margin-top: 30px; }
    
    .top-bar, .bottom-bar { display: flex; justify-content: space-between; align-items: center; padding: 10px 20px; background: #222; border-bottom: 1px solid #444; }
    .bottom-bar { justify-content: center; border-top: 1px solid #444; border-bottom: none; }
    .grid-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 10px; width: 100%; overflow-y: auto; padding: 15px; flex: 1; }
    .card { background: #2a2a35; border: 1px solid #555; padding: 10px; border-radius: 6px; text-align: center; cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 60px; font-weight: bold; color: var(--acc); }
    .card:hover { border-color: var(--acc); background: #353545; transform: scale(1.05); }
    .item-desc { font-size: 10px; color: #aaa; margin-top: 5px; font-weight: normal; }
    
    #map-title { color: var(--acc); font-weight: bold; text-decoration: underline; cursor: pointer; font-size: 18px; }
    
    #battle-hud { height: 80px; background: rgba(0,0,0,0.6); display: flex; align-items: center; justify-content: space-between; padding: 0 20px; border-bottom: 1px solid #444; }
    .bar-frame { width: 140px; height: 15px; background: #222; border: 1px solid #555; margin: 5px 0; border-radius: 4px; overflow: hidden; }
    .bar-fill { height: 100%; width: 100%; transition: width 0.3s; }
    .hp-color { background: var(--hp); } .enemy-color { background: var(--dmg); }
    #battle-field { flex: 1; display: flex; justify-content: space-between; align-items: flex-end; padding: 20px 50px; }
    .sprite { font-size: 80px; filter: drop-shadow(0 5px 10px #000); transition: transform 0.1s; }
    
    .panel { height: 260px; background: var(--panel); border-top: 4px solid #fff; padding: 15px; display: flex; flex-direction: column; }
    #cmd-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; height: 100%; }
    .cmd-btn { background: #223; border: 2px solid #556; color: #fff; font-size: 16px; cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; }
    .cmd-btn:hover { border-color: var(--acc); }
    
    #q-text { font-size: 20px; margin: 10px 0; color: #aaf; text-align: center; min-height: 60px; display: flex; align-items: center; justify-content: center; padding: 0 20px; }
    #choice-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; height: 100%; }
    .choice-btn { text-align: left; padding: 5px 10px; font-size: 14px; display: flex; align-items: center; justify-content: center; }
    #write-area { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; }
    #write-input { font-family: 'Press Start 2P', monospace; font-size: 24px; padding: 10px; width: 90%; text-align: center; background: #222; color: #fff; border: 2px solid var(--acc); border-radius: 8px; margin-bottom: 15px; }

    .overlay { position: absolute; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.9); backdrop-filter: blur(5px); z-index: 100; display: flex; flex-direction: column; align-items: center; justify-content: center; }
    #defense-panel { background: rgba(100, 20, 20, 0.95); }
    .timer-bar { width: 80%; height: 20px; background: #500; margin-bottom: 20px; border: 2px solid #fff; border-radius: 10px; overflow:hidden;}
    #def-timer-fill { height: 100%; background: #f00; width: 100%; transition: width 0.1s linear; }
    #def-word { font-family: 'Press Start 2P', monospace; font-size: 40px; text-shadow: 4px 4px 0 #000; margin-bottom: 5px; letter-spacing: 3px; }
    #def-meaning { font-size: 24px; color: #aaf; margin-bottom: 20px; }
    #fb-correct-ans { color: var(--acc); font-size: 30px; margin: 20px; font-weight: bold; font-family: 'Press Start 2P', monospace; }

    #title-list { width: 90%; height: 70%; overflow-y: auto; background: #222; border: 2px solid #555; padding: 10px; display: grid; grid-template-columns: 1fr; gap: 5px; }
    .title-row { padding: 10px; background: #333; display: flex; justify-content: space-between; align-items: center; border: 2px solid transparent; cursor: pointer; }
    .title-row:hover { background: #444; }
    .title-row.locked { opacity: 0.5; background: #111; color: #888; }
    .title-row.equipped { border: 2px solid var(--acc); background: #353545; }
    .title-name { font-weight: bold; font-size: 14px; }
    .title-desc { font-size: 10px; color: #aaa; margin-left:10px; }

    #debug-btn { position: absolute; bottom: 15px; right: 15px; font-size: 40px; cursor: pointer; z-index: 9999; display: none; }
    .debug-row { margin: 10px; display: flex; gap: 10px; align-items: center; }
    .debug-input { padding: 5px; width: 60px; background: #000; color: #fff; border: 1px solid #555; }

    .pop-text { position: absolute; font-size: 24px; font-weight: bold; animation: floatUp 1s forwards; z-index: 200; text-shadow: 2px 2px 0 #000; }
    @keyframes floatUp { to { transform: translateY(-50px); opacity: 0; } }
    .shake { animation: shake 0.4s; }
    @keyframes shake { 0%,100%{transform:translateX(0)} 25%{transform:translateX(-10px)} 75%{transform:translateX(10px)} }
    .attack-anim { animation: lunge 0.3s; }
    @keyframes lunge { 0%{transform:translate(0,0)} 50%{transform:translate(40px, -20px) scale(1.2)} 100%{transform:translate(0,0)} }
    .damage-anim { animation: flashRed 0.3s; }
    @keyframes flashRed { 0%,100%{filter:none} 50%{filter:sepia(1) hue-rotate(-50deg) saturate(3)} }
    @keyframes deathSpin { 0% { transform: scale(1) rotate(0deg); opacity: 1; } 100% { transform: scale(0) rotate(720deg); opacity: 0; } }
    .enemy-death { animation: deathSpin 1.5s forwards; }
    .confetti { position: absolute; width: 10px; height: 10px; animation: fall linear forwards; }
    @keyframes fall { to { transform: translateY(100vh) rotate(720deg); } }
</style>
</head>
<body>

<div id="error-box"></div>
<script>
    window.onerror = function(msg, url, line) {
        document.getElementById('error-box').style.display = 'block';
        document.getElementById('error-box').innerHTML += "âš ï¸ ERROR: " + msg + "<br>Line: " + line + "<br><br>";
    };
</script>

<div id="app">
    <div id="screen-title" class="screen active center">
        <h1 onclick="Debug.trigger()">WORD QUEST<br><span style="font-size:0.6em;color:#fff;">GRADE 1</span></h1>
        <p style="color:#aaa;">Complete Edition (v15)</p>
        <button id="btn-start" class="btn start-btn">START</button>
    </div>

    <div id="screen-map" class="screen">
        <div class="top-bar">
            <div>
                <div id="map-title">NOVICE</div>
                <div class="status-text" style="font-size:12px; color:#aaa;">Lv.<span id="map-lv">1</span></div>
            </div>
            <div>ğŸ’° <span id="map-gold">0</span></div>
        </div>
        <div id="map-grid" class="grid-container"></div>
        <div class="bottom-bar">
            <button id="btn-shop" class="btn">SHOP</button>
            <button id="btn-titles" class="btn">TITLES</button>
            <button id="btn-title-back" class="btn">TITLE</button>
        </div>
    </div>

    <div id="screen-shop" class="screen">
        <h2>ITEM SHOP</h2>
        <div style="text-align:center;margin-bottom:10px;">Gold: <span id="shop-gold" style="color:#ffd700">0</span></div>
        <div id="shop-container" class="grid-container" style="justify-content:center;"></div>
        <div class="bottom-bar"><button id="btn-shop-back" class="btn">BACK</button></div>
    </div>

    <div id="screen-battle" class="screen">
        <div id="battle-hud">
            <div>Lv.<span id="hud-lv">1</span> <span style="font-size:12px">HP <span id="hp-text">100</span></span></div>
            <div class="bar-frame"><div id="hp-bar" class="bar-fill hp-color"></div></div>
            <div style="margin-left:10px;">VS</div>
            <div class="bar-frame"><div id="enemy-hp-bar" class="bar-fill enemy-color"></div></div>
        </div>
        <div id="battle-field">
            <div style="text-align:center;"><div class="sprite" id="hero-sprite">âš”ï¸</div><div id="active-buffs" style="height:20px;"></div></div>
            <div style="text-align:center;"><div class="sprite" id="enemy-sprite">ğŸ‘¾</div></div>
        </div>
        <div id="panel-command" class="panel">
            <div id="cmd-grid">
                <button id="btn-atk" class="cmd-btn">âš”ï¸ ATTACK<br><span style="font-size:10px;">Choice</span></button>
                <button id="btn-mag" class="cmd-btn">ğŸ”¥ MAGIC<br><span style="font-size:10px;">Writing</span></button>
                <button id="btn-item" class="cmd-btn">ğŸ’ ITEM</button>
                <button id="btn-flee" class="cmd-btn">ğŸƒ FLEE</button>
            </div>
        </div>
        <div id="panel-question" class="panel hidden">
            <div style="display:flex;justify-content:space-between;">
                <span style="color:#ffd700;">QUIZ</span>
                <button id="btn-cancel" class="btn small">CANCEL</button>
            </div>
            <div id="q-text"></div>
            <div id="choice-grid"></div>
            <div id="write-area" class="hidden">
                <input type="text" id="write-input" autocomplete="off">
                <button id="btn-submit" class="btn">ATTACK</button>
            </div>
        </div>
        <div id="defense-panel" class="overlay hidden">
            <h2>DEFEND!</h2>
            <div class="timer-bar"><div id="def-timer-fill"></div></div>
            <div id="def-word"></div>
            <div id="def-meaning"></div>
            <div style="color:#ccc;">Type to Block!</div>
        </div>
        <div id="feedback-overlay" class="overlay hidden">
            <h2 class="danger-text">WRONG!</h2>
            <div style="color:#ddd;">Answer:</div>
            <div id="fb-correct-ans"></div>
            <div id="btn-fb-ok" class="btn">NEXT</div>
        </div>
        <div id="item-overlay" class="overlay hidden">
            <h2>ITEMS</h2><div id="item-list" class="grid-2col" style="gap:10px;"></div><button id="btn-close-item" class="btn">CLOSE</button>
        </div>
    </div>

    <div id="title-overlay" class="overlay hidden"><h2>TITLES</h2><div id="title-list"></div><button id="btn-close-title" class="btn">CLOSE</button></div>

    <div id="debug-overlay" class="overlay hidden">
        <h2 style="color:#d580ff">DEBUG</h2>
        <div class="debug-row">Lv: <input type="number" id="debug-lv" value="1" class="debug-input"> <button id="btn-debug-setlv" class="btn small">SET</button></div>
        <div class="debug-row">Gold: <input type="number" id="debug-gold" value="1000" class="debug-input"> <button id="btn-debug-setgold" class="btn small">SET</button></div>
        <button id="btn-debug-unlock" class="btn">UNLOCK TITLES</button>
        <button id="btn-debug-restore" class="btn">RESTORE HP</button>
        <button id="btn-close-debug" class="btn">CLOSE</button>
    </div>

    <div id="screen-result" class="screen center">
        <div id="confetti-container"></div>
        <h1 style="color:#0f0;">VICTORY!</h1>
        <div style="font-size:80px;margin:20px;">ğŸ†</div>
        <div>Exp +<span id="res-exp"></span> / Gold +<span id="res-gold"></span></div>
        <div id="levelup-msg" style="color:var(--acc);margin-top:10px;white-space:pre;"></div>
        <button id="btn-next" class="btn start-btn">NEXT</button>
    </div>
    
    <div id="debug-btn" onclick="UI.toggleDebug()">ğŸ</div>
</div>

<script>
// --- GLOBAL DATA ---
const Game = {};
const Battle = {};
const UI = {};
const Debug = {};

const UNITS = ["0","1","2","3","4","5","6","7","8","9","10","WR","LR","Ex"];
const SHOP_ITEMS = [
    {id:'potion', name:'Potion', icon:'ğŸ·', cost:50, desc:"Heal 50 HP"},
    {id:'bomb', name:'Bomb', icon:'ğŸ’£', cost:80, desc:"Next Quiz: 2 Choices"},
    {id:'power', name:'Power', icon:'âš”ï¸', cost:150, desc:"Atk UP (until miss)"},
    {id:'iron_shield', name:'Shield', icon:'ğŸ›¡ï¸', cost:150, desc:"Auto Block (1 time)"},
    {id:'wisdom', name:'Wisdom', icon:'ğŸ“œ', cost:200, desc:"Exp x2 (1 Battle)"},
    {id:'wealth', name:'Wealth', icon:'ğŸ’°', cost:200, desc:"Gold x2 (1 Battle)"},
    {id:'crit_gem', name:'Crit Gem', icon:'ğŸ’', cost:300, desc:"Next Hit: Critical"},
    {id:'vampire', name:'Fang', icon:'ğŸ¦‡', cost:350, desc:"Drain HP (1 hit)"},
    {id:'hi_potion', name:'Hi-Potion', icon:'ğŸ·+', cost:120, desc:"Heal 150 HP"},
    {id:'elixir', name:'Elixir', icon:'ğŸ§ª', cost:200, desc:"Full Heal"}
];
const DB = [
{u:"0",e:"nice",j:"ã™ã¦ããª"},{u:"0",e:"meet",j:"ä¼šã†"},{u:"0",e:"you",j:"ã‚ãªãŸ"},{u:"0",e:"good",j:"ã‚ˆã„"},{u:"0",e:"morning",j:"æœ"},{u:"0",e:"I",j:"ç§"},{u:"0",e:"am",j:"â€¦ã§ã™"},{u:"0",e:"call",j:"å‘¼ã¶"},{u:"0",e:"me",j:"ç§ã‚’"},{u:"0",e:"please",j:"ãŠé¡˜ã„ã—ã¾ã™"},{u:"0",e:"oh",j:"ã‚ã‚‰"},{u:"0",e:"are",j:"â€¦ã§ã™"},{u:"0",e:"yes",j:"ã¯ã„"},{u:"0",e:"no",j:"ã„ã„ãˆ"},{u:"0",e:"not",j:"â€¦ã§ãªã„"},{u:"0",e:"so",j:"ãã‚Œã§"},{u:"0",e:"tennis",j:"ãƒ†ãƒ‹ã‚¹"},{u:"0",e:"fan",j:"ãƒ•ã‚¡ãƒ³"},{u:"0",e:"sport",j:"ã‚¹ãƒãƒ¼ãƒ„"},
{u:"1",e:"hello",j:"ã“ã‚“ã«ã¡ã¯"},{u:"1",e:"everyone",j:"ã¿ã‚“ãª"},{u:"1",e:"like",j:"å¥½ã"},{u:"1",e:"do",j:"ï¼»ç–‘å•æ–‡ï¼½"},{u:"1",e:"play",j:"éŠã¶"},{u:"1",e:"soccer",j:"ã‚µãƒƒã‚«ãƒ¼"},{u:"1",e:"that",j:"ã‚ã‚Œ"},{u:"1",e:"is",j:"â€¦ã§ã™"},{u:"1",e:"pen",j:"ãƒšãƒ³"},{u:"1",e:"apple",j:"ãƒªãƒ³ã‚´"},{u:"1",e:"have",j:"æŒã£ã¦ã„ã‚‹"},{u:"1",e:"question",j:"è³ªå•"},{u:"1",e:"number",j:"æ•°"},{u:"1",e:"read",j:"èª­ã‚€"},{u:"1",e:"math",j:"æ•°å­¦"},{u:"1",e:"answer",j:"ç­”ãˆ"},{u:"1",e:"study",j:"å‹‰å¼·ã™ã‚‹"},{u:"1",e:"every",j:"æ¯â€¦"},{u:"1",e:"day",j:"æ—¥"},{u:"1",e:"music",j:"éŸ³æ¥½"},
{u:"2",e:"teacher",j:"å…ˆç”Ÿ"},{u:"2",e:"Ms.",j:"â€¦ã•ã‚“"},{u:"2",e:"Mr.",j:"â€¦ã•ã‚“"},{u:"2",e:"club",j:"ã‚¯ãƒ©ãƒ–"},{u:"2",e:"she",j:"å½¼å¥³"},{u:"2",e:"he",j:"å½¼"},{u:"2",e:"friend",j:"å‹é”"},{u:"2",e:"picture",j:"å†™çœŸ"},{u:"2",e:"this",j:"ã“ã‚Œ"},{u:"2",e:"who",j:"ã ã‚Œ"},{u:"2",e:"know",j:"çŸ¥ã£ã¦ã„ã‚‹"},{u:"2",e:"it",j:"ãã‚Œ"},{u:"2",e:"food",j:"é£Ÿã¹ç‰©"},{u:"2",e:"right",j:"æ­£ã—ã„"},{u:"2",e:"often",j:"ã‚ˆã"},{u:"2",e:"very",j:"ã¨ã¦ã‚‚"},{u:"2",e:"much",j:"ãŸãã•ã‚“"},{u:"2",e:"sometimes",j:"ã¨ãã©ã"},{u:"2",e:"see",j:"è¦‹ã‚‹"},{u:"2",e:"but",j:"ã—ã‹ã—"},{u:"2",e:"usually",j:"ãŸã„ã¦ã„"},{u:"2",e:"how",j:"ã©ã†"},
{u:"3",e:"cook",j:"æ–™ç†ã™ã‚‹"},{u:"3",e:"breakfast",j:"æœé£Ÿ"},{u:"3",e:"always",j:"ã„ã¤ã‚‚"},{u:"3",e:"toast",j:"ãƒˆãƒ¼ã‚¹ãƒˆ"},{u:"3",e:"fruit",j:"æœç‰©"},{u:"3",e:"yogurt",j:"ãƒ¨ãƒ¼ã‚°ãƒ«ãƒˆ"},{u:"3",e:"milk",j:"ç‰›ä¹³"},{u:"3",e:"eat",j:"é£Ÿã¹ã‚‹"},{u:"3",e:"rice",j:"ç±³"},{u:"3",e:"soup",j:"ã‚¹ãƒ¼ãƒ—"},{u:"3",e:"hungry",j:"ç©ºè…¹"},{u:"3",e:"what",j:"ä½•"},{u:"3",e:"can",j:"ã§ãã‚‹"},{u:"3",e:"noodle",j:"éºº"},{u:"3",e:"many",j:"ãŸãã•ã‚“ã®"},{u:"3",e:"word",j:"å˜èª"},{u:"3",e:"we",j:"ç§ãŸã¡"},{u:"3",e:"use",j:"ä½¿ã†"},
{u:"4",e:"gym",j:"ä½“è‚²é¤¨"},{u:"4",e:"near",j:"è¿‘ãã«"},{u:"4",e:"house",j:"å®¶"},{u:"4",e:"where",j:"ã©ã“"},{u:"4",e:"live",j:"ä½ã‚€"},{u:"4",e:"station",j:"é§…"},{u:"4",e:"park",j:"å…¬åœ’"},{u:"4",e:"come",j:"æ¥ã‚‹"},{u:"4",e:"cool",j:"ã‹ã£ã“ã„ã„"},{u:"4",e:"nice",j:"å„ªã—ã„"},{u:"4",e:"child",j:"å­ä¾›"},{u:"4",e:"these",j:"ã“ã‚Œã‚‰"},{u:"4",e:"they",j:"å½¼ã‚‰"},{u:"4",e:"my",j:"ç§ã®"},{u:"4",e:"parent",j:"è¦ª"},{u:"4",e:"welcome",j:"ã‚ˆã†ã“ã"},{u:"4",e:"here",j:"ã“ã“"},{u:"4",e:"busy",j:"å¿™ã—ã„"},{u:"4",e:"our",j:"ç§ãŸã¡ã®"},{u:"4",e:"bag",j:"ã‹ã°ã‚“"},{u:"4",e:"dad",j:"çˆ¶"},{u:"4",e:"table",j:"ãƒ†ãƒ¼ãƒ–ãƒ«"},{u:"4",e:"look",j:"è¦‹ã‚‹"},{u:"4",e:"man",j:"ç”·æ€§"},{u:"4",e:"door",j:"ãƒ‰ã‚¢"},{u:"4",e:"grandpa",j:"ç¥–çˆ¶"},{u:"4",e:"girl",j:"å¥³ã®å­"},{u:"4",e:"woman",j:"å¥³æ€§"},{u:"4",e:"bench",j:"ãƒ™ãƒ³ãƒ"},{u:"4",e:"bookstore",j:"æœ¬å±‹"},{u:"4",e:"street",j:"é€šã‚Š"},{u:"4",e:"hospital",j:"ç—…é™¢"},{u:"4",e:"perfect",j:"å®Œç’§ãª"},{u:"4",e:"gift",j:"è´ˆã‚Šç‰©"},{u:"4",e:"birthday",j:"èª•ç”Ÿæ—¥"},
{u:"5",e:"shirt",j:"ã‚·ãƒ£ãƒ„"},{u:"5",e:"design",j:"ãƒ‡ã‚¶ã‚¤ãƒ³"},{u:"5",e:"animal",j:"å‹•ç‰©"},{u:"5",e:"kind",j:"ç¨®é¡"},{u:"5",e:"buy",j:"è²·ã†"},{u:"5",e:"want",j:"ã»ã—ã„"},{u:"5",e:"black",j:"é»’"},{u:"5",e:"which",j:"ã©ã¡ã‚‰"},{u:"5",e:"or",j:"ã¾ãŸã¯"},{u:"5",e:"blue",j:"é’"},{u:"5",e:"cute",j:"ã‹ã‚ã„ã„"},{u:"5",e:"how",j:"ã©ã‚Œãã‚‰ã„"},{u:"5",e:"much",j:"ã„ãã‚‰"},{u:"5",e:"dollar",j:"ãƒ‰ãƒ«"},{u:"5",e:"great",j:"ã™ã”ã„"},{u:"5",e:"take",j:"å–ã‚‹"},{u:"5",e:"really",j:"æœ¬å½“ã«"},{u:"5",e:"festival",j:"ç¥­ã‚Š"},{u:"5",e:"when",j:"ã„ã¤"},{u:"5",e:"Sunday",j:"æ—¥æ›œæ—¥"},{u:"5",e:"free",j:"æš‡ãª"},{u:"5",e:"then",j:"ãã‚Œãªã‚‰"},{u:"5",e:"let's",j:"â€¦ã—ã‚ˆã†"},{u:"5",e:"go",j:"è¡Œã"},{u:"5",e:"together",j:"ä¸€ç·’ã«"},{u:"5",e:"calendar",j:"ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼"},{u:"5",e:"January",j:"1æœˆ"},{u:"5",e:"February",j:"2æœˆ"},{u:"5",e:"March",j:"3æœˆ"},{u:"5",e:"April",j:"4æœˆ"},{u:"5",e:"May",j:"5æœˆ"},{u:"5",e:"June",j:"6æœˆ"},{u:"5",e:"July",j:"7æœˆ"},{u:"5",e:"August",j:"8æœˆ"},{u:"5",e:"September",j:"9æœˆ"},{u:"5",e:"October",j:"10æœˆ"},{u:"5",e:"November",j:"11æœˆ"},{u:"5",e:"December",j:"12æœˆ"},{u:"5",e:"holiday",j:"ä¼‘æ—¥"},{u:"5",e:"mid-",j:"ä¸­ã”ã‚ã®"},{u:"5",e:"summer",j:"å¤"},{u:"5",e:"vacation",j:"ä¼‘æš‡"},{u:"5",e:"party",j:"ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼"},{u:"5",e:"start",j:"å§‹ã¾ã‚‹"},{u:"5",e:"o'clock",j:"â€¦æ™‚"},
{u:"6",e:"whose",j:"ã ã‚Œã®"},{u:"6",e:"shoe",j:"é´"},{u:"6",e:"hey",j:"ã‚„ã‚"},{u:"6",e:"ticket",j:"ãƒã‚±ãƒƒãƒˆ"},{u:"6",e:"yours",j:"ã‚ãªãŸã®ã‚‚ã®"},{u:"6",e:"mine",j:"ç§ã®ã‚‚ã®"},{u:"6",e:"maybe",j:"ãŸã¶ã‚“"},{u:"6",e:"some",j:"ã„ãã¤ã‹ã®"},{u:"6",e:"name",j:"åå‰"},{u:"6",e:"write",j:"æ›¸ã"},{u:"6",e:"family",j:"å®¶æ—"},{u:"6",e:"line",j:"åˆ—"},{u:"6",e:"touch",j:"è§¦ã‚‹"},{u:"6",e:"now",j:"ä»Š"},{u:"6",e:"father",j:"çˆ¶"},{u:"6",e:"student",j:"ç”Ÿå¾’"},{u:"6",e:"junior",j:"å¹´ä¸‹ã®"},{u:"6",e:"high",j:"é«˜ã„"},{u:"6",e:"school",j:"å­¦æ ¡"},{u:"6",e:"year",j:"å¹´"},{u:"6",e:"old",j:"å¤ã„"},{u:"6",e:"teach",j:"æ•™ãˆã‚‹"},{u:"6",e:"little",j:"å°ã•ã„"},{u:"6",e:"sister",j:"å§‰å¦¹"},{u:"6",e:"brother",j:"å…„å¼Ÿ"},{u:"6",e:"mother",j:"æ¯"},{u:"6",e:"writer",j:"ä½œå®¶"},{u:"6",e:"poem",j:"è©©"},{u:"6",e:"long",j:"é•·ã„"},{u:"6",e:"life",j:"äººç”Ÿ"},{u:"6",e:"nature",j:"è‡ªç„¶"},{u:"6",e:"speak",j:"è©±ã™"},{u:"6",e:"famous",j:"æœ‰åãª"},{u:"6",e:"story",j:"ç‰©èª"},{u:"6",e:"English",j:"è‹±èª"},{u:"6",e:"language",j:"è¨€èª"},{u:"6",e:"people",j:"äººã€…"},{u:"6",e:"around",j:"å‘¨ã‚Šã«"},{u:"6",e:"world",j:"ä¸–ç•Œ"},
{u:"7",e:"enjoy",j:"æ¥½ã—ã‚€"},{u:"7",e:"listen",j:"èã"},{u:"7",e:"well",j:"ä¸Šæ‰‹ã«"},{u:"7",e:"cannot",j:"ã§ããªã„"},{u:"7",e:"fast",j:"é€Ÿã"},{u:"7",e:"swim",j:"æ³³ã"},{u:"7",e:"act",j:"æ¼”ã˜ã‚‹"},{u:"7",e:"hard",j:"ä¸€ç”Ÿæ‡¸å‘½"},{u:"7",e:"fan",j:"ã†ã¡ã‚"},{u:"7",e:"Japanese",j:"æ—¥æœ¬ã®"},{u:"7",e:"traditional",j:"ä¼çµ±çš„ãª"},{u:"7",e:"comic",j:"å–œåŠ‡ã®"},{u:"7",e:"storytelling",j:"è©±èŠ¸"},{u:"7",e:"stage",j:"èˆå°"},{u:"7",e:"cushion",j:"åº§å¸ƒå›£"},{u:"7",e:"prop",j:"å°é“å…·"},{u:"7",e:"role",j:"å½¹"},{u:"7",e:"only",j:"ã ã‘"},{u:"7",e:"towel",j:"ã‚¿ã‚ªãƒ«"},{u:"7",e:"different",j:"é•ã£ãŸ"},{u:"7",e:"minute",j:"åˆ†"},{u:"7",e:"limit",j:"åˆ¶é™"},
{u:"8",e:"presentation",j:"ç™ºè¡¨"},{u:"8",e:"slide",j:"ã‚¹ãƒ©ã‚¤ãƒ‰"},{u:"8",e:"give",j:"ä¸ãˆã‚‹"},{u:"8",e:"class",j:"æˆæ¥­"},{u:"8",e:"surprise",j:"é©šã‹ã™"},{u:"8",e:"her",j:"å½¼å¥³ã‚’"},{u:"8",e:"send",j:"é€ã‚‹"},{u:"8",e:"card",j:"ã‚«ãƒ¼ãƒ‰"},{u:"8",e:"look",j:"è¦‹ã‚‹"},{u:"8",e:"any",j:"ã„ãã¤ã‹ã®"},{u:"8",e:"flower",j:"èŠ±"},{u:"8",e:"mountain",j:"å±±"},{u:"8",e:"river",j:"å·"},{u:"8",e:"lake",j:"æ¹–"},{u:"8",e:"beautiful",j:"ç¾ã—ã„"},{u:"8",e:"popular",j:"äººæ°—ã®ã‚ã‚‹"},{u:"8",e:"place",j:"å ´æ‰€"},{u:"8",e:"visit",j:"è¨ªã‚Œã‚‹"},{u:"8",e:"pencil",j:"é‰›ç­†"},
{u:"9",e:"yesterday",j:"æ˜¨æ—¥"},{u:"9",e:"went",j:"è¡Œã£ãŸ"},{u:"9",e:"park",j:"é§è»Šã™ã‚‹"},{u:"9",e:"ate",j:"é£Ÿã¹ãŸ"},{u:"9",e:"candy",j:"ã‚­ãƒ£ãƒ³ãƒ‡ã‚£"},{u:"9",e:"end",j:"çµ‚ã‚ã‚Š"},{u:"9",e:"saw",j:"è¦‹ãŸ"},{u:"9",e:"lot",j:"ãŸãã•ã‚“"},{u:"9",e:"had",j:"æŒã£ã¦ã„ãŸ"},{u:"9",e:"fun",j:"æ¥½ã—ã¿"},{u:"9",e:"did",j:"ã—ãŸ"},{u:"9",e:"stay",j:"æ»åœ¨ã™ã‚‹"},{u:"9",e:"late",j:"é…ã"},{u:"9",e:"night",j:"å¤œ"},{u:"9",e:"watch",j:"è¦‹ã‚‹"},{u:"9",e:"TV",j:"ãƒ†ãƒ¬ãƒ“"},{u:"9",e:"homework",j:"å®¿é¡Œ"},{u:"9",e:"come",j:"æ¥ã‚‹"},{u:"9",e:"new",j:"æ–°ã—ã„"},{u:"9",e:"shrine",j:"ç¥ç¤¾"},{u:"9",e:"make",j:"ä½œã‚‹"},{u:"9",e:"money",j:"ãŠé‡‘"},{u:"9",e:"bag",j:"è¢‹"},{u:"9",e:"luck",j:"é‹"},
{u:"10",e:"pizza",j:"ãƒ”ã‚¶"},{u:"10",e:"video",j:"ãƒ“ãƒ‡ã‚ª"},{u:"10",e:"game",j:"ã‚²ãƒ¼ãƒ "},{u:"10",e:"scary",j:"æ€–ã„"},{u:"10",e:"city",j:"éƒ½å¸‚"},{u:"10",e:"hot",j:"æš‘ã„"},{u:"10",e:"swimming",j:"æ°´æ³³"},{u:"10",e:"Christmas",j:"ã‚¯ãƒªã‚¹ãƒã‚¹"},{u:"10",e:"was",j:"â€¦ã ã£ãŸ"},{u:"10",e:"were",j:"â€¦ã ã£ãŸ"},{u:"10",e:"home",j:"å®¶"},{u:"10",e:"check",j:"èª¿ã¹ã‚‹"},{u:"10",e:"later",j:"ã‚ã¨ã§"},{u:"10",e:"email",j:"ãƒ¡ãƒ¼ãƒ«"},{u:"10",e:"wait",j:"å¾…ã¤"},{u:"10",e:"drink",j:"é£²ã‚€"},{u:"10",e:"water",j:"æ°´"},{u:"10",e:"doing",j:"ã—ã¦ã„ã‚‹"},{u:"10",e:"reading",j:"èª­ã‚“ã§ã„ã‚‹"},{u:"10",e:"playing",j:"éŠã‚“ã§ã„ã‚‹"},{u:"10",e:"sleeping",j:"å¯ã¦ã„ã‚‹"},{u:"10",e:"eating",j:"é£Ÿã¹ã¦ã„ã‚‹"},{u:"10",e:"watching",j:"è¦‹ã¦ã„ã‚‹"},{u:"10",e:"studying",j:"å‹‰å¼·ã—ã¦ã„ã‚‹"},{u:"10",e:"cooking",j:"æ–™ç†ã—ã¦ã„ã‚‹"},{u:"10",e:"coming",j:"æ¥ã¦ã„ã‚‹"},{u:"10",e:"using",j:"ä½¿ã£ã¦ã„ã‚‹"},{u:"10",e:"running",j:"èµ°ã£ã¦ã„ã‚‹"},
{u:"WR",e:"zoo",j:"å‹•ç‰©åœ’"},{u:"WR",e:"piano",j:"ãƒ”ã‚¢ãƒ"},{u:"WR",e:"guitar",j:"ã‚®ã‚¿ãƒ¼"},{u:"WR",e:"notebook",j:"ãƒãƒ¼ãƒˆ"},{u:"WR",e:"dictionary",j:"è¾æ›¸"},{u:"WR",e:"clock",j:"æ™‚è¨ˆ"},{u:"WR",e:"map",j:"åœ°å›³"},{u:"WR",e:"computer",j:"PC"},{u:"WR",e:"chair",j:"ã„ã™"},{u:"WR",e:"window",j:"çª“"},{u:"WR",e:"salad",j:"ã‚µãƒ©ãƒ€"},{u:"WR",e:"sunny",j:"æ™´ã‚Œ"},{u:"WR",e:"rainy",j:"é›¨"},{u:"WR",e:"one",j:"1"},{u:"WR",e:"two",j:"2"},{u:"WR",e:"three",j:"3"},{u:"WR",e:"ten",j:"10"},{u:"WR",e:"hundred",j:"100"},{u:"WR",e:"cat",j:"çŒ«"},{u:"WR",e:"dog",j:"çŠ¬"},{u:"WR",e:"bird",j:"é³¥"},{u:"WR",e:"Monday",j:"æœˆæ›œæ—¥"},{u:"WR",e:"library",j:"å›³æ›¸é¤¨"},{u:"WR",e:"first",j:"1ç•ªç›®"},{u:"WR",e:"second",j:"2ç•ªç›®"},{u:"WR",e:"head",j:"é ­"},{u:"WR",e:"hand",j:"æ‰‹"},{u:"WR",e:"get up",j:"èµ·ãã‚‹"},{u:"WR",e:"nurse",j:"çœ‹è­·å¸«"},{u:"WR",e:"kitchen",j:"å°æ‰€"},{u:"WR",e:"science",j:"ç†ç§‘"},{u:"WR",e:"eraser",j:"æ¶ˆã—ã‚´ãƒ "},{u:"WR",e:"ruler",j:"å®šè¦"},{u:"WR",e:"backpack",j:"ãƒªãƒ¥ãƒƒã‚¯"},{u:"WR",e:"marker",j:"ãƒãƒ¼ã‚«ãƒ¼"},{u:"WR",e:"blackboard",j:"é»’æ¿"},{u:"WR",e:"sofa",j:"ã‚½ãƒ•ã‚¡ãƒ¼"},{u:"WR",e:"bed",j:"ãƒ™ãƒƒãƒ‰"},{u:"WR",e:"table",j:"ãƒ†ãƒ¼ãƒ–ãƒ«"},{u:"WR",e:"door",j:"ãƒ‰ã‚¢"},{u:"WR",e:"bath",j:"ãŠé¢¨å‘‚"},{u:"WR",e:"living room",j:"ãƒªãƒ“ãƒ³ã‚°"},{u:"WR",e:"bedroom",j:"å¯å®¤"},{u:"WR",e:"garden",j:"åº­"},{u:"WR",e:"stairs",j:"éšæ®µ"},{u:"WR",e:"wall",j:"å£"},{u:"WR",e:"ceiling",j:"å¤©äº•"},{u:"WR",e:"floor",j:"åºŠ"},{u:"WR",e:"roof",j:"å±‹æ ¹"},{u:"WR",e:"flower",j:"èŠ±"},{u:"WR",e:"tree",j:"æœ¨"},{u:"WR",e:"grass",j:"è‰"},{u:"WR",e:"sun",j:"å¤ªé™½"},{u:"WR",e:"moon",j:"æœˆ"},{u:"WR",e:"star",j:"æ˜Ÿ"},{u:"WR",e:"cloud",j:"é›²"},{u:"WR",e:"wind",j:"é¢¨"},{u:"WR",e:"snow",j:"é›ª"},{u:"WR",e:"river",j:"å·"},{u:"WR",e:"sea",j:"æµ·"},{u:"WR",e:"mountain",j:"å±±"},{u:"WR",e:"lake",j:"æ¹–"},{u:"WR",e:"forest",j:"æ£®"},{u:"WR",e:"park",j:"å…¬åœ’"},{u:"WR",e:"station",j:"é§…"},{u:"WR",e:"airport",j:"ç©ºæ¸¯"},{u:"WR",e:"port",j:"æ¸¯"},{u:"WR",e:"hospital",j:"ç—…é™¢"},{u:"WR",e:"bank",j:"éŠ€è¡Œ"},{u:"WR",e:"post office",j:"éƒµä¾¿å±€"},{u:"WR",e:"supermarket",j:"ã‚¹ãƒ¼ãƒ‘ãƒ¼"},{u:"WR",e:"convenience store",j:"ã‚³ãƒ³ãƒ“ãƒ‹"},{u:"WR",e:"restaurant",j:"ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³"},{u:"WR",e:"museum",j:"åšç‰©é¤¨"},{u:"WR",e:"hotel",j:"ãƒ›ãƒ†ãƒ«"},{u:"WR",e:"police station",j:"è­¦å¯Ÿç½²"},{u:"WR",e:"fire station",j:"æ¶ˆé˜²ç½²"},{u:"WR",e:"temple",j:"å¯º"},{u:"WR",e:"shrine",j:"ç¥ç¤¾"},{u:"WR",e:"castle",j:"åŸ"},{u:"WR",e:"church",j:"æ•™ä¼š"},{u:"WR",e:"gym",j:"ä½“è‚²é¤¨"},{u:"WR",e:"pool",j:"ãƒ—ãƒ¼ãƒ«"},{u:"WR",e:"stadium",j:"ç«¶æŠ€å ´"},{u:"WR",e:"soccer",j:"ã‚µãƒƒã‚«ãƒ¼"},{u:"WR",e:"baseball",j:"é‡çƒ"},{u:"WR",e:"basketball",j:"ãƒã‚¹ã‚±"},{u:"WR",e:"volleyball",j:"ãƒãƒ¬ãƒ¼"},{u:"WR",e:"tennis",j:"ãƒ†ãƒ‹ã‚¹"},{u:"WR",e:"badminton",j:"ãƒãƒ‰ãƒŸãƒ³ãƒˆãƒ³"},{u:"WR",e:"swimming",j:"æ°´æ³³"},{u:"WR",e:"dance",j:"ãƒ€ãƒ³ã‚¹"},{u:"WR",e:"running",j:"ãƒ©ãƒ³ãƒ‹ãƒ³ã‚°"},{u:"WR",e:"skiing",j:"ã‚¹ã‚­ãƒ¼"},{u:"WR",e:"skating",j:"ã‚¹ã‚±ãƒ¼ãƒˆ"},{u:"WR",e:"judo",j:"æŸ”é“"},{u:"WR",e:"kendo",j:"å‰£é“"},{u:"WR",e:"music",j:"éŸ³æ¥½"},{u:"WR",e:"art",j:"ç¾è¡“"},{u:"WR",e:"drama",j:"æ¼”åŠ‡"},{u:"WR",e:"red",j:"èµ¤"},{u:"WR",e:"blue",j:"é’"},{u:"WR",e:"green",j:"ç·‘"},{u:"WR",e:"yellow",j:"é»„è‰²"},{u:"WR",e:"black",j:"é»’"},{u:"WR",e:"white",j:"ç™½"},{u:"WR",e:"orange",j:"ã‚ªãƒ¬ãƒ³ã‚¸è‰²"},{u:"WR",e:"purple",j:"ç´«"},{u:"WR",e:"pink",j:"ãƒ”ãƒ³ã‚¯"},{u:"WR",e:"brown",j:"èŒ¶è‰²"},{u:"WR",e:"gray",j:"ç°è‰²"},{u:"WR",e:"gold",j:"é‡‘"},{u:"WR",e:"silver",j:"éŠ€"},{u:"WR",e:"Sunday",j:"æ—¥æ›œæ—¥"},{u:"WR",e:"Tuesday",j:"ç«æ›œæ—¥"},{u:"WR",e:"Wednesday",j:"æ°´æ›œæ—¥"},{u:"WR",e:"Thursday",j:"æœ¨æ›œæ—¥"},{u:"WR",e:"Friday",j:"é‡‘æ›œæ—¥"},{u:"WR",e:"Saturday",j:"åœŸæ›œæ—¥"},{u:"WR",e:"January",j:"1æœˆ"},{u:"WR",e:"February",j:"2æœˆ"},{u:"WR",e:"March",j:"3æœˆ"},{u:"WR",e:"April",j:"4æœˆ"},{u:"WR",e:"May",j:"5æœˆ"},{u:"WR",e:"June",j:"6æœˆ"},{u:"WR",e:"July",j:"7æœˆ"},{u:"WR",e:"August",j:"8æœˆ"},{u:"WR",e:"September",j:"9æœˆ"},{u:"WR",e:"October",j:"10æœˆ"},{u:"WR",e:"November",j:"11æœˆ"},{u:"WR",e:"December",j:"12æœˆ"},{u:"WR",e:"spring",j:"æ˜¥"},{u:"WR",e:"summer",j:"å¤"},{u:"WR",e:"autumn",j:"ç§‹"},{u:"WR",e:"winter",j:"å†¬"},{u:"WR",e:"morning",j:"æœ"},{u:"WR",e:"afternoon",j:"åˆå¾Œ"},{u:"WR",e:"evening",j:"å¤•æ–¹"},{u:"WR",e:"night",j:"å¤œ"},{u:"WR",e:"today",j:"ä»Šæ—¥"},{u:"WR",e:"tomorrow",j:"æ˜æ—¥"},{u:"WR",e:"yesterday",j:"æ˜¨æ—¥"},{u:"WR",e:"hair",j:"é«ª"},{u:"WR",e:"face",j:"é¡”"},{u:"WR",e:"eye",j:"ç›®"},{u:"WR",e:"ear",j:"è€³"},{u:"WR",e:"nose",j:"é¼»"},{u:"WR",e:"mouth",j:"å£"},{u:"WR",e:"tooth",j:"æ­¯"},{u:"WR",e:"neck",j:"é¦–"},{u:"WR",e:"shoulder",j:"è‚©"},{u:"WR",e:"arm",j:"è…•"},{u:"WR",e:"finger",j:"æŒ‡"},{u:"WR",e:"leg",j:"è„š"},{u:"WR",e:"foot",j:"è¶³"},{u:"WR",e:"body",j:"ä½“"},{u:"WR",e:"heart",j:"å¿ƒ"},{u:"WR",e:"mother",j:"æ¯"},{u:"WR",e:"father",j:"çˆ¶"},{u:"WR",e:"sister",j:"å§‰å¦¹"},{u:"WR",e:"brother",j:"å…„å¼Ÿ"},{u:"WR",e:"grandmother",j:"ç¥–æ¯"},{u:"WR",e:"grandfather",j:"ç¥–çˆ¶"},{u:"WR",e:"aunt",j:"ãŠã°"},{u:"WR",e:"uncle",j:"ãŠã˜"},{u:"WR",e:"cousin",j:"ã„ã¨ã“"},{u:"WR",e:"friend",j:"å‹é”"},{u:"WR",e:"teacher",j:"å…ˆç”Ÿ"},{u:"WR",e:"student",j:"ç”Ÿå¾’"},{u:"WR",e:"doctor",j:"åŒ»è€…"},{u:"WR",e:"police officer",j:"è­¦å¯Ÿå®˜"},{u:"WR",e:"firefighter",j:"æ¶ˆé˜²å£«"},{u:"WR",e:"baker",j:"ãƒ‘ãƒ³å±‹"},{u:"WR",e:"florist",j:"èŠ±å±‹"},{u:"WR",e:"driver",j:"é‹è»¢æ‰‹"},{u:"WR",e:"singer",j:"æ­Œæ‰‹"},{u:"WR",e:"artist",j:"èŠ¸è¡“å®¶"},{u:"WR",e:"writer",j:"ä½œå®¶"},{u:"WR",e:"player",j:"é¸æ‰‹"},{u:"WR",e:"rabbit",j:"ã‚¦ã‚µã‚®"},{u:"WR",e:"mouse",j:"ãƒã‚ºãƒŸ"},{u:"WR",e:"cow",j:"ç‰›"},{u:"WR",e:"horse",j:"é¦¬"},{u:"WR",e:"sheep",j:"ç¾Š"},{u:"WR",e:"pig",j:"è±š"},{u:"WR",e:"chicken",j:"é¶"},{u:"WR",e:"lion",j:"ãƒ©ã‚¤ã‚ªãƒ³"},{u:"WR",e:"tiger",j:"ãƒˆãƒ©"},{u:"WR",e:"elephant",j:"ã‚¾ã‚¦"},{u:"WR",e:"monkey",j:"ã‚µãƒ«"},{u:"WR",e:"bear",j:"ã‚¯ãƒ"},{u:"WR",e:"panda",j:"ãƒ‘ãƒ³ãƒ€"},{u:"WR",e:"koala",j:"ã‚³ã‚¢ãƒ©"},{u:"WR",e:"snake",j:"ãƒ˜ãƒ“"},{u:"WR",e:"fish",j:"é­š"},{u:"WR",e:"insect",j:"æ˜†è™«"},{u:"WR",e:"bread",j:"ãƒ‘ãƒ³"},{u:"WR",e:"rice",j:"ã”é£¯"},{u:"WR",e:"noodle",j:"éºº"},{u:"WR",e:"egg",j:"åµ"},{u:"WR",e:"meat",j:"è‚‰"},{u:"WR",e:"vegetable",j:"é‡èœ"},{u:"WR",e:"fruit",j:"æœç‰©"},{u:"WR",e:"apple",j:"ãƒªãƒ³ã‚´"},{u:"WR",e:"banana",j:"ãƒãƒŠãƒŠ"},{u:"WR",e:"orange",j:"ã‚ªãƒ¬ãƒ³ã‚¸"},{u:"WR",e:"grape",j:"ãƒ–ãƒ‰ã‚¦"},{u:"WR",e:"strawberry",j:"ã‚¤ãƒã‚´"},{u:"WR",e:"melon",j:"ãƒ¡ãƒ­ãƒ³"},{u:"WR",e:"tomato",j:"ãƒˆãƒãƒˆ"},{u:"WR",e:"potato",j:"ã‚¸ãƒ£ã‚¬ã‚¤ãƒ¢"},{u:"WR",e:"carrot",j:"ãƒ‹ãƒ³ã‚¸ãƒ³"},{u:"WR",e:"onion",j:"ã‚¿ãƒãƒã‚®"},{u:"WR",e:"corn",j:"ãƒˆã‚¦ãƒ¢ãƒ­ã‚³ã‚·"},{u:"WR",e:"milk",j:"ç‰›ä¹³"},{u:"WR",e:"juice",j:"ã‚¸ãƒ¥ãƒ¼ã‚¹"},{u:"WR",e:"tea",j:"ãŠèŒ¶"},{u:"WR",e:"coffee",j:"ã‚³ãƒ¼ãƒ’ãƒ¼"},{u:"WR",e:"cake",j:"ã‚±ãƒ¼ã‚­"},{u:"WR",e:"ice cream",j:"ã‚¢ã‚¤ã‚¹ã‚¯ãƒªãƒ¼ãƒ "},{u:"WR",e:"chocolate",j:"ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆ"},{u:"WR",e:"cookie",j:"ã‚¯ãƒƒã‚­ãƒ¼"},{u:"WR",e:"sandwich",j:"ã‚µãƒ³ãƒ‰ã‚¤ãƒƒãƒ"},{u:"WR",e:"hamburger",j:"ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼"},{u:"WR",e:"pizza",j:"ãƒ”ã‚¶"},{u:"WR",e:"curry",j:"ã‚«ãƒ¬ãƒ¼"},{u:"WR",e:"steak",j:"ã‚¹ãƒ†ãƒ¼ã‚­"},{u:"WR",e:"sushi",j:"å¯¿å¸"},{u:"WR",e:"tempura",j:"å¤©ã·ã‚‰"},{u:"WR",e:"car",j:"è»Š"},{u:"WR",e:"bus",j:"ãƒã‚¹"},{u:"WR",e:"train",j:"é›»è»Š"},{u:"WR",e:"bike",j:"è‡ªè»¢è»Š"},{u:"WR",e:"taxi",j:"ã‚¿ã‚¯ã‚·ãƒ¼"},{u:"WR",e:"plane",j:"é£›è¡Œæ©Ÿ"},{u:"WR",e:"ship",j:"èˆ¹"},{u:"WR",e:"boat",j:"ãƒœãƒ¼ãƒˆ"},{u:"WR",e:"four",j:"4"},{u:"WR",e:"five",j:"5"},{u:"WR",e:"six",j:"6"},{u:"WR",e:"seven",j:"7"},{u:"WR",e:"eight",j:"8"},{u:"WR",e:"nine",j:"9"},{u:"WR",e:"eleven",j:"11"},{u:"WR",e:"twelve",j:"12"},{u:"WR",e:"twenty",j:"20"},{u:"WR",e:"thirty",j:"30"},{u:"WR",e:"forty",j:"40"},{u:"WR",e:"fifty",j:"50"},{u:"WR",e:"sixty",j:"60"},{u:"WR",e:"seventy",j:"70"},{u:"WR",e:"eighty",j:"80"},{u:"WR",e:"ninety",j:"90"},{u:"WR",e:"thousand",j:"1000"},{u:"WR",e:"Japan",j:"æ—¥æœ¬"},{u:"WR",e:"America",j:"ã‚¢ãƒ¡ãƒªã‚«"},{u:"WR",e:"Canada",j:"ã‚«ãƒŠãƒ€"},{u:"WR",e:"Australia",j:"ã‚ªãƒ¼ã‚¹ãƒˆãƒ©ãƒªã‚¢"},{u:"WR",e:"China",j:"ä¸­å›½"},{u:"WR",e:"Korea",j:"éŸ“å›½"},{u:"WR",e:"India",j:"ã‚¤ãƒ³ãƒ‰"},{u:"WR",e:"UK",j:"ã‚¤ã‚®ãƒªã‚¹"},{u:"WR",e:"France",j:"ãƒ•ãƒ©ãƒ³ã‚¹"},{u:"WR",e:"Germany",j:"ãƒ‰ã‚¤ãƒ„"},{u:"WR",e:"Italy",j:"ã‚¤ã‚¿ãƒªã‚¢"},{u:"WR",e:"Spain",j:"ã‚¹ãƒšã‚¤ãƒ³"},{u:"WR",e:"Brazil",j:"ãƒ–ãƒ©ã‚¸ãƒ«"},{u:"WR",e:"Russia",j:"ãƒ­ã‚·ã‚¢"},{u:"WR",e:"Egypt",j:"ã‚¨ã‚¸ãƒ—ãƒˆ"},
{u:"LR",e:"history",j:"æ­´å²"},{u:"LR",e:"museum",j:"åšç‰©é¤¨"},{u:"LR",e:"interesting",j:"ãŠã‚‚ã—ã‚ã„"},{u:"LR",e:"grandfather",j:"ç¥–çˆ¶"},{u:"LR",e:"art",j:"èŠ¸è¡“"},{u:"LR",e:"excited",j:"èˆˆå¥®ã—ãŸ"},{u:"LR",e:"say",j:"è¨€ã†"},{u:"LR",e:"think",j:"æ€ã†"},{u:"LR",e:"find",j:"è¦‹ã¤ã‘ã‚‹"},{u:"LR",e:"clock",j:"æ™‚è¨ˆ"},{u:"LR",e:"London",j:"ãƒ­ãƒ³ãƒ‰ãƒ³"},{u:"LR",e:"ago",j:"å‰"},{u:"LR",e:"culture",j:"æ–‡åŒ–"},{u:"LR",e:"Europe",j:"ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘"},{u:"LR",e:"word",j:"è¨€è‘‰"},{u:"LR",e:"mean",j:"æ„å‘³ã™ã‚‹"},{u:"LR",e:"right",j:"å³"},{u:"LR",e:"back",j:"æˆ»ã‚‹"},{u:"LR",e:"ghost",j:"å¹½éœŠ"},{u:"LR",e:"scary",j:"æ€–ã„"},{u:"LR",e:"character",j:"ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼"},{u:"LR",e:"present",j:"ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆ"},{u:"LR",e:"rich",j:"é‡‘æŒã¡"},{u:"LR",e:"money",j:"é‡‘"},{u:"LR",e:"poor",j:"è²§ã—ã„"},{u:"LR",e:"life",j:"ç”Ÿæ´»"},{u:"LR",e:"work",j:"åƒã"},{u:"LR",e:"change",j:"å¤‰ãˆã‚‹"},{u:"LR",e:"future",j:"æœªæ¥"},{u:"LR",e:"kind",j:"è¦ªåˆ‡ãª"},
{u:"Ex",e:"shrine",j:"ç¥ç¤¾"},{u:"Ex",e:"tree",j:"æœ¨"},{u:"Ex",e:"sea",j:"æµ·"},{u:"Ex",e:"big",j:"å¤§ãã„"},{u:"Ex",e:"mountain",j:"å±±"},{u:"Ex",e:"long",j:"é•·ã„"},{u:"Ex",e:"small",j:"å°ã•ã„"},{u:"Ex",e:"box",j:"ç®±"},{u:"Ex",e:"dog",j:"çŠ¬"},{u:"Ex",e:"ball",j:"ãƒœãƒ¼ãƒ«"},{u:"Ex",e:"desk",j:"æœº"},{u:"Ex",e:"cat",j:"çŒ«"},{u:"Ex",e:"bed",j:"ãƒ™ãƒƒãƒ‰"},{u:"Ex",e:"bird",j:"é³¥"},{u:"Ex",e:"book",j:"æœ¬"},{u:"Ex",e:"old",j:"å¤ã„"},{u:"Ex",e:"chair",j:"ã„ã™"},{u:"Ex",e:"cup",j:"ã‚«ãƒƒãƒ—"},{u:"Ex",e:"look",j:"è¦‹ã‚‹"},{u:"Ex",e:"new",j:"æ–°ã—ã„"}
];

let Player = {
    hp:100, maxHp:100, gold:0, lv:1, exp:0, nextExp:100,
    items: { potion:1, power:1, bomb:1 },
    equippedTitle: 0, unlockedTitles: [0],
    stats: { totalGold:0, items:0, correct:0, noDamageCount:0, unitPerfect:{} },
    getTitleName: function() {
        for(let i=0; i<TITLE_DB.length; i++) {
            if(TITLE_DB[i].id === this.equippedTitle) return TITLE_DB[i].name;
        }
        return "Unknown";
    }
};

const TITLE_DB = [
    {id:0, name:"Beginner", desc:"Welcome", cond:true},
    {id:1, name:"Novice", desc:"Lv 5", cond:function(h){return h.lv>=5}},
    {id:2, name:"Apprentice", desc:"Lv 10", cond:function(h){return h.lv>=10}},
    {id:3, name:"Soldier", desc:"Lv 20", cond:function(h){return h.lv>=20}},
    {id:4, name:"Veteran", desc:"Lv 30", cond:function(h){return h.lv>=30}},
    {id:5, name:"Master", desc:"Lv 50", cond:function(h){return h.lv>=50}},
    {id:6, name:"Legend", desc:"Lv 99", cond:function(h){return h.lv>=99}},
    {id:10, name:"Rich", desc:"1000 G", cond:function(h){return h.gold>=1000}},
    {id:11, name:"Millionaire", desc:"5000 G", cond:function(h){return h.stats.totalGold>=5000}},
    {id:12, name:"Shopper", desc:"Buy 10 Items", cond:function(h){return h.stats.items>=10}},
    {id:13, name:"Iron Wall", desc:"Block 50 times", cond:function(h){return h.stats.blocks>=50}},
    {id:14, name:"Scholar", desc:"100 Correct", cond:function(h){return h.stats.correct>=100}},
    {id:20, name:"Untouchable", desc:"No Dmg Win", cond:function(h){return h.stats.noDamageCount>=1}},
    {id:30, name:"Unit 0 Master", desc:"U0 No Dmg", cond:function(h){return h.stats.unitPerfect['0']}},
    {id:31, name:"Unit 1 Master", desc:"U1 No Dmg", cond:function(h){return h.stats.unitPerfect['1']}},
    {id:32, name:"Unit 2 Master", desc:"U2 No Dmg", cond:function(h){return h.stats.unitPerfect['2']}},
    {id:33, name:"Unit 3 Master", desc:"U3 No Dmg", cond:function(h){return h.stats.unitPerfect['3']}},
    {id:34, name:"Unit 4 Master", desc:"U4 No Dmg", cond:function(h){return h.stats.unitPerfect['4']}},
    {id:35, name:"Unit 5 Master", desc:"U5 No Dmg", cond:function(h){return h.stats.unitPerfect['5']}},
    {id:36, name:"Unit 6 Master", desc:"U6 No Dmg", cond:function(h){return h.stats.unitPerfect['6']}},
    {id:37, name:"Unit 7 Master", desc:"U7 No Dmg", cond:function(h){return h.stats.unitPerfect['7']}},
    {id:38, name:"Unit 8 Master", desc:"U8 No Dmg", cond:function(h){return h.stats.unitPerfect['8']}},
    {id:39, name:"Unit 9 Master", desc:"U9 No Dmg", cond:function(h){return h.stats.unitPerfect['9']}},
    {id:40, name:"Unit 10 Master", desc:"U10 No Dmg", cond:function(h){return h.stats.unitPerfect['10']}},
    {id:41, name:"Word Master", desc:"WR No Dmg", cond:function(h){return h.stats.unitPerfect['WR']}},
    {id:99, name:"Cheater", desc:"Debug Mode", cond:function(h){return h.unlockedTitles.includes(99)}}
];

// --- HELPER ---
function setText(id, text) {
    const el = document.getElementById(id);
    if (el) el.innerText = text;
}
function getUnitIndex(u) {
    return UNITS.indexOf(u);
}

// --- UI METHODS ---
UI.show = function(id) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    if(id === 'screen-map') Game.updateMap();
    if(id === 'screen-shop') Game.updateShopUI();
    if(id === 'screen-result') UI.confetti();
};
UI.hideOverlay = function(id) { document.getElementById(id).classList.add('hidden'); };
UI.showOverlay = function(id) { document.getElementById(id).classList.remove('hidden'); };
UI.showPanel = function(id) {
    document.querySelectorAll('.panel').forEach(p => p.classList.add('hidden'));
    document.getElementById(id).classList.remove('hidden');
};
UI.toggleDebug = function() { document.getElementById('debug-overlay').classList.toggle('hidden'); };
UI.popup = function(txt, col='#fff') {
    const d = document.createElement('div');
    d.className = 'pop-text';
    d.innerText = txt;
    d.style.color = col;
    d.style.left = '50%';
    d.style.top = '30%';
    document.getElementById('screen-battle').appendChild(d);
    setTimeout(() => d.remove(), 1000);
};
UI.confetti = function() {
    const c = document.getElementById('confetti-container');
    c.innerHTML = '';
    for(let i=0; i<30; i++) {
        const p = document.createElement('div');
        p.className = 'confetti';
        p.style.left = Math.random()*100+'%';
        p.style.backgroundColor = `hsl(${Math.random()*360},100%,50%)`;
        p.style.animationDuration = (1+Math.random()*2)+'s';
        c.appendChild(p);
    }
};
UI.setText = function(id, text) {
    const el = document.getElementById(id);
    if(el) el.innerText = text;
};

// --- GAME METHODS ---
Game.start = function() { UI.show('screen-map'); };
Game.renderMap = function() {
    const g = document.getElementById('map-grid'); g.innerHTML = "";
    UNITS.forEach(u => {
        const d = document.createElement('div'); d.className = 'card';
        let txt = u==="WR"?"Word Room":(u==="LR"?"Let's Read": (u==="Ex"?"Extra":"Unit "+u));
        d.innerHTML = `<div style="color:var(--acc);font-weight:bold;">${txt}</div>`;
        d.onclick = () => Battle.init(u);
        g.appendChild(d);
    });
};
Game.updateMap = function() {
    UI.setText('map-gold', Player.gold);
    UI.setText('map-lv', Player.lv);
    UI.setText('map-title', Player.getTitleName());
};
Game.updateShopUI = function() {
    UI.setText('shop-gold', Player.gold);
};
Game.checkTitles = function() {
    TITLE_DB.forEach(t => {
        let conditionMet = (typeof t.cond === 'function') ? t.cond(Player) : t.cond;
        if(conditionMet && !Player.unlockedTitles.includes(t.id)) {
            Player.unlockedTitles.push(t.id);
        }
    });
};
Game.openTitles = function() {
    Game.checkTitles();
    const l = document.getElementById('title-list'); l.innerHTML = "";
    TITLE_DB.forEach(t => {
        let conditionMet = (typeof t.cond === 'function') ? t.cond(Player) : t.cond;
        if(conditionMet && !Player.unlockedTitles.includes(t.id)) Player.unlockedTitles.push(t.id);
        
        const unlocked = Player.unlockedTitles.includes(t.id);
        const equipped = Player.equippedTitle === t.id;
        const d = document.createElement('div');
        d.className = `title-row ${unlocked?'':'locked'} ${equipped?'equipped':''}`;
        d.innerHTML = `<div class="title-name">${unlocked ? "ğŸ”“ "+t.name : "ğŸ”’ "+t.name}</div><div class="title-desc">${t.desc}</div>`;
        if(unlocked) d.onclick = () => { 
            Player.equippedTitle = t.id; 
            UI.popup("Equipped!","#0f0"); UI.hideOverlay('title-overlay'); 
            Game.updateMap();
        };
        l.appendChild(d);
    });
    UI.showOverlay('title-overlay');
};
Game.showShop = function() {
    const c = document.getElementById('shop-container'); c.innerHTML = "";
    SHOP_ITEMS.forEach(i => {
        const d = document.createElement('div'); d.className = 'card';
        d.innerHTML = `<div>${i.icon} ${i.name}<br><span style="font-size:10px">${i.cost}G</span><div class="item-desc">${i.desc}</div></div>`;
        d.onclick = () => Game.buyItem(i.id, i.cost);
        c.appendChild(d);
    });
    UI.show('screen-shop');
};
Game.buyItem = function(k, c) {
    if(Player.gold >= c) {
        Player.gold -= c; Player.items[k] = (Player.items[k]||0)+1;
        Player.stats.items++;
        Game.updateShopUI(); UI.popup("Bought!", "#0f0");
        Game.checkTitles();
    } else alert("Not enough Gold");
};

// --- BATTLE METHODS ---
Battle.init = function(u) {
    this.words = DB.filter(d=>d.u===u);
    if(!this.words.length) return alert("No words!");
    this.currentUnit = u;
    this.takenDamage = false;
    
    const uIdx = getUnitIndex(u);
    const baseHP = 500 + (uIdx * 60); 
    const baseAtk = 25 + (uIdx * 2);
    
    this.enemy = { hp: baseHP, max: baseHP, atk: baseAtk };
    this.buffs = {atk:false, crit:false, block:false, bomb:false, drain:false};
    Player.hp = Player.maxHp;
    
    const s=document.getElementById('enemy-sprite'); 
    s.classList.remove('enemy-death'); s.style.transform="scale(1)";
    UI.show('screen-battle'); 
    this.update(); this.showCmd();
};

Battle.update = function() {
    document.getElementById('hp-bar').style.width = (Player.hp/Player.maxHp*100)+"%";
    document.getElementById('enemy-hp-bar').style.width = (this.enemy.hp/this.enemy.max*100)+"%";
    UI.setText('hp-text', Player.hp);
    UI.setText('hud-lv', Player.lv);
    let h="";
    if(this.buffs.atk) h+="<span class='buff-icon'>âš”ï¸</span>";
    if(this.buffs.crit) h+="<span class='buff-icon'>ğŸ’</span>";
    if(this.buffs.block) h+="<span class='buff-icon'>ğŸ›¡ï¸</span>";
    if(this.buffs.bomb) h+="<span class='buff-icon'>ğŸ’£</span>";
    if(this.buffs.drain) h+="<span class='buff-icon'>ğŸ¦‡</span>";
    document.getElementById('active-buffs').innerHTML = h;
};

Battle.showCmd = function() {
    this.state="CMD"; this.lock=false; UI.showPanel('panel-command');
};

Battle.act = function(type) {
    this.type = type;
    if(this.words.length===0) return;
    this.cur = this.words[Math.floor(Math.random()*this.words.length)];
    this.state="QUIZ"; this.lock=false; UI.showPanel('panel-question');
    
    let reverse = (Math.random() > 0.5 && type === 'attack');
    let q = reverse ? this.cur.e : this.cur.j;
    this.curAnswer = reverse ? this.cur.j : this.cur.e;
    
    UI.setText('q-text', q);
    
    if(type==='magic') {
        document.getElementById('choice-grid').classList.add('hidden');
        document.getElementById('write-area').classList.remove('hidden');
        document.getElementById('write-input').value=""; document.getElementById('write-input').focus();
    } else {
        document.getElementById('write-area').classList.add('hidden');
        const g=document.getElementById('choice-grid'); g.classList.remove('hidden'); g.innerHTML="";
        
        let num = this.buffs.bomb ? 2 : 4;
        if(this.buffs.bomb) this.buffs.bomb = false;

        let opts=[this.cur];
        let pool = this.words.length > 5 ? this.words : DB;
        while(opts.length < num) {
            let r = pool[Math.floor(Math.random()*pool.length)];
            if(!opts.includes(r)) opts.push(r);
        }
        opts.sort(()=>Math.random()-0.5).forEach(w=>{
            const b=document.createElement('button'); b.className='choice-btn btn';
            b.innerText = reverse ? w.j : w.e;
            b.onclick=()=>this.check(w===this.cur);
            g.appendChild(b);
        });
    }
};

Battle.openItems = function() {
    const l=document.getElementById('item-list'); l.innerHTML="";
    SHOP_ITEMS.forEach(i=>{
        if(Player.items[i.id]>0) {
            const b=document.createElement('button'); b.className='btn';
            b.innerHTML=`${i.icon} ${i.name} (x${Player.items[i.id]})`;
            b.onclick=()=>{
                Player.items[i.id]--; UI.hideOverlay('item-overlay');
                if(i.id=='potion') Player.hp=Math.min(Player.maxHp, Player.hp+50);
                if(i.id=='power') this.buffs.atk=true;
                if(i.id=='iron_shield') this.buffs.block=true;
                if(i.id=='crit_gem') this.buffs.crit=true;
                if(i.id=='bomb') this.buffs.bomb=true;
                if(i.id=='vampire') this.buffs.drain=true;
                if(i.id=='elixir') Player.hp=Player.maxHp;
                if(i.id=='hi_potion') Player.hp=Math.min(Player.maxHp, Player.hp+150);
                this.update();
            };
            l.appendChild(b);
        }
    });
    UI.showOverlay('item-overlay');
};

Battle.check = function(isCorrect) {
    if(this.lock) return; this.lock=true;
    if(isCorrect) {
        Player.stats.correct++;
        document.getElementById('hero-sprite').classList.add('attack-anim');
        setTimeout(()=>document.getElementById('hero-sprite').classList.remove('attack-anim'),300);
        
        let baseDmg = this.type==='magic' ? 100 : 60;
        let lvMult = 1 + (Player.lv * 0.05);
        let dmg = Math.floor(baseDmg * lvMult);

        if(this.buffs.atk) dmg = Math.floor(dmg * 1.5);
        if(this.buffs.crit) { dmg = Math.floor(dmg * 2.0); this.buffs.crit=false; }
        
        // Vampire Drain
        if(this.buffs.drain) {
            let heal = Math.floor(dmg * 0.5);
            Player.hp = Math.min(Player.maxHp, Player.hp + heal);
            UI.popup("Drain! +"+heal, "#0f0");
            this.buffs.drain = false;
        }

        this.enemy.hp -= dmg; 
        this.update(); 
        UI.popup(dmg, "#fa0");
        
        if(this.enemy.hp<=0) {
            document.getElementById('enemy-sprite').classList.add('enemy-death');
            setTimeout(()=>this.win(),1500);
        } else setTimeout(()=>this.startDefense(),800);
    } else {
        this.takeDamage(this.enemy.atk);
        if(Player.hp > 0) {
            UI.setText('fb-correct-ans', this.curAnswer || this.cur.e);
            UI.showOverlay('feedback-overlay');
        }
    }
};

Battle.startDefense = function() {
    this.state="DEFENSE"; this.lock=false;
    if(this.buffs.block) { this.buffs.block=false; setTimeout(()=>this.endDef(true),500); return; }
    
    setTimeout(()=>{
        UI.showOverlay('defense-panel');
        document.getElementById('write-input').value = ""; 
        let pool = this.words.length > 0 ? this.words : DB;
        let r = pool[Math.floor(Math.random()*pool.length)];
        this.defWord = r.e; this.defMeaning = r.j;
        this.defIdx=0; this.defTimer=300;
        
        UI.setText('def-meaning', this.defMeaning);
        this.renderDef(); this.defLoop();
    },300);
};

Battle.defLoop = function() {
    if(this.state!=="DEFENSE") return;
    this.defTimer--;
    document.getElementById('def-timer-fill').style.width = (this.defTimer/300*100)+"%";
    if(this.defTimer<=0) this.endDef(false);
    else requestAnimationFrame(()=>this.defLoop());
};

Battle.renderDef = function() {
    let h=""; for(let i=0; i<this.defWord.length; i++) {
        h+=`<span style="color:${i<this.defIdx?'#0f0':'#fff'}">${this.defWord[i]}</span>`;
    }
    document.getElementById('def-word').innerHTML=h;
};

Battle.checkDef = function(key) {
    if(this.lock || document.getElementById('defense-panel').classList.contains('hidden')) return;
    if(key.toLowerCase()===this.defWord[this.defIdx].toLowerCase()){
        this.defIdx++; this.renderDef();
        if(this.defIdx>=this.defWord.length) this.endDef(true);
    }
};

Battle.endDef = function(success) {
    this.state="BATTLE"; UI.hideOverlay('defense-panel');
    if(success) {
        let dmg=40; 
        if(Player.lv>=20) dmg+=10; 
        Player.stats.blocks = (Player.stats.blocks||0)+1;
        this.enemy.hp-=dmg; UI.popup("Counter! "+dmg, "#0ff"); this.update();
        if(this.enemy.hp<=0) {
             document.getElementById('enemy-sprite').classList.add('enemy-death');
             setTimeout(()=>this.win(),1500);
        } else setTimeout(()=>this.showCmd(),1000);
    } else {
        this.takeDamage(this.enemy.atk);
        if(Player.hp > 0) setTimeout(()=>this.showCmd(),1000);
    }
};

Battle.takeDamage = function(dmg) {
    this.takenDamage = true;
    Player.hp -= dmg;
    document.getElementById('hero-sprite').classList.add('damage-anim');
    setTimeout(()=>document.getElementById('hero-sprite').classList.remove('damage-anim'),300);
    UI.popup("Hit! -"+dmg, "#f00"); 
    document.getElementById('app').classList.add('shake');
    setTimeout(()=>document.getElementById('app').classList.remove('shake'),400);
    this.update();
    if(Player.hp<=0) { alert("GAME OVER"); UI.show('screen-title'); }
};

Battle.win = function() {
    const uIdx = getUnitIndex(this.currentUnit);
    let baseRew = 50 * (1 + uIdx * 0.15); 
    let finalRew = Math.floor(baseRew * (1 + Player.lv * 0.05));

    Player.gold += finalRew; 
    Player.exp += finalRew; 
    Player.stats.totalGold += finalRew;
    
    if(Player.exp >= Player.nextExp) { 
        Player.lv++; 
        Player.exp -= Player.nextExp; 
        Player.nextExp = Math.floor(Player.nextExp * 1.2); 
        Player.maxHp += 10; 
        Player.hp = Player.maxHp; 
    }
    
    if(!this.takenDamage) {
        Player.stats.noDamageCount++;
        if(!Player.stats.unitPerfect) Player.stats.unitPerfect = {};
        Player.stats.unitPerfect[this.currentUnit] = true;
    }
    Game.checkTitles();

    UI.setText('res-gold', finalRew);
    UI.setText('res-exp', finalRew);
    
    let msg = "";
    if(!this.takenDamage) msg += "âœ¨ Perfect Clear! (No Damage) âœ¨\n";
    UI.setText('levelup-msg', msg);

    UI.show('screen-result');
    document.getElementById('enemy-sprite').classList.remove('enemy-death');
    UI.confetti();
};

// --- DEBUG METHODS ---
Debug.cnt=0;
Debug.trigger = function(){ this.cnt++; if(this.cnt>=15){ this.cnt=0; Player.unlockedTitles.push(99); document.getElementById('debug-btn').style.display='block'; alert("Debug Unlocked!"); } };
Debug.setLv = function(){ Player.lv=parseInt(document.getElementById('debug-lv').value); Player.hp=100+(Player.lv-1)*10; Player.maxHp=Player.hp; Game.updateMap(); };
Debug.setGold = function(){ Player.gold=parseInt(document.getElementById('debug-gold').value); Game.updateMap(); };
Debug.unlockAllTitles = function(){ Player.unlockedTitles=[0,1,2,3,4,5,6,10,11,12,13,14,20,30,31,32,33,34,35,36,37,38,39,40,41,99]; alert("Titles Unlocked"); };
Debug.fullRestore = function(){ Player.hp=Player.maxHp; alert("Recovered!"); };

// --- INIT ---
window.onload = function() {
    Game.renderMap();
    document.getElementById('btn-start').onclick = Game.start;
    document.getElementById('btn-shop').onclick = Game.showShop;
    document.getElementById('btn-titles').onclick = Game.openTitles;
    document.getElementById('btn-title-back').onclick = () => UI.show('screen-title');
    document.getElementById('btn-shop-back').onclick = () => UI.show('screen-map');
    document.getElementById('btn-atk').onclick = () => Battle.act('attack');
    document.getElementById('btn-mag').onclick = () => Battle.act('magic');
    document.getElementById('btn-item').onclick = () => Battle.openItems();
    document.getElementById('btn-flee').onclick = () => UI.show('screen-map');
    document.getElementById('btn-cancel').onclick = () => Battle.showCmd();
    document.getElementById('btn-submit').onclick = () => Battle.check(document.getElementById('write-input').value.trim().toLowerCase()===Battle.cur.e.toLowerCase());
    document.getElementById('btn-fb-ok').onclick = () => { UI.hideOverlay('feedback-overlay'); Battle.startDefense(); };
    document.getElementById('btn-next').onclick = () => UI.show('screen-map');
    document.getElementById('btn-close-item').onclick = () => UI.hideOverlay('item-overlay');
    document.getElementById('btn-close-title').onclick = () => UI.hideOverlay('title-overlay');
    document.getElementById('btn-close-debug').onclick = () => UI.toggleDebug();
    document.getElementById('btn-debug-setlv').onclick = Debug.setLv;
    document.getElementById('btn-debug-setgold').onclick = Debug.setGold;
    document.getElementById('btn-debug-unlock').onclick = Debug.unlockAllTitles;
    document.getElementById('btn-debug-restore').onclick = Debug.fullRestore;
    document.getElementById('debug-btn').onclick = UI.toggleDebug;

    window.onkeydown = function(e) {
        if(Battle.state==="QUIZ" && Battle.type==='magic' && e.key==='Enter') document.getElementById('btn-submit').click();
        if(Battle.state==="DEFENSE" && e.key.length===1) Battle.checkDef(e.key);
    };
};
</script>
</body>
</html>
